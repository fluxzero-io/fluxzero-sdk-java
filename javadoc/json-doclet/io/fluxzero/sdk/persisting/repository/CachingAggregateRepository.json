{
  "name" : "CachingAggregateRepository",
  "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository",
  "packageName" : "io.fluxzero.sdk.persisting.repository",
  "kind" : "class",
  "modifiers" : [ "public" ],
  "annotations" : [ {
    "annotationType" : "lombok.RequiredArgsConstructor",
    "values" : {}
  }, {
    "annotationType" : "lombok.extern.slf4j.Slf4j",
    "values" : {}
  } ],
  "documentation" : " A wrapper around a delegate {@link AggregateRepository} that ensures cached aggregates stay in sync with the event\n log.\n <p>\n This repository starts an internal {@link io.fluxzero.sdk.tracking.client.TrackingClient} that tails the\n global event log. It deserializes received events and applies them to any corresponding aggregate in the cache,\n thereby ensuring that all cached aggregates reflect the latest known state.\n\n <p>This design makes it possible to load up-to-date aggregates within event and notification handlers, allowing\n these types of handlers to rely on the event model as a read model. This enables event-sourced read models without\n requiring the developer to maintain separate query-oriented state.\n\n <p>Specifically, when an event handler loads an aggregate, the repository first ensures that all events up to and\n including the event being handled have been processed by the tracker and applied to the cache. This prevents race\n conditions and stale reads.\n\n <p>If a cache miss occurs, the aggregate is loaded from the delegate repository and cached for future access.\n\n <h2>Features</h2>\n <ul>\n   <li>Transparent event replay on cached aggregates.</li>\n   <li>Ensures correct ordering and consistency during event handling via index synchronization.</li>\n   <li>Relationship metadata is kept up to date using {@link Relationship} updates.</li>\n   <li>Configurable slow-tracking detection via {@link #slowTrackingThreshold} (default 10 seconds).</li>\n </ul>\n\n <p>This caching repository is enabled by default in all Fluxzero applications to support aggregate access\n during event processing. If needed, it can be disabled using\n {@link FluxzeroBuilder#disableAutomaticAggregateCaching()}, in which case aggregate state will not be tracked\n or kept in sync automatically, and developers are expected to manage consistency manually.\n\n @see AggregateRepository\n @see Entity\n @see io.fluxzero.sdk.tracking.client.TrackingClient\n",
  "typeParameters" : [ ],
  "superClass" : "java.lang.Object",
  "interfaces" : [ "io.fluxzero.sdk.persisting.repository.AggregateRepository" ],
  "fields" : [ {
    "name" : "cache",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.cache",
    "type" : "io.fluxzero.sdk.persisting.caching.Cache",
    "modifiers" : [ "final", "private" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  }, {
    "name" : "client",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.client",
    "type" : "io.fluxzero.sdk.configuration.client.Client",
    "modifiers" : [ "final", "private" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  }, {
    "name" : "delegate",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.delegate",
    "type" : "io.fluxzero.sdk.persisting.repository.AggregateRepository",
    "modifiers" : [ "final", "private" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  }, {
    "name" : "lastEventIndex",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.lastEventIndex",
    "type" : "long",
    "modifiers" : [ "private", "volatile" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  }, {
    "name" : "relationshipsCache",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.relationshipsCache",
    "type" : "io.fluxzero.sdk.persisting.caching.Cache",
    "modifiers" : [ "final", "private" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  }, {
    "name" : "serializer",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.serializer",
    "type" : "io.fluxzero.sdk.common.serialization.Serializer",
    "modifiers" : [ "final", "private" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  }, {
    "name" : "slowTrackingThreshold",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.slowTrackingThreshold",
    "type" : "java.time.Duration",
    "modifiers" : [ "public", "static" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  }, {
    "name" : "started",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository.started",
    "type" : "java.util.concurrent.atomic.AtomicBoolean",
    "modifiers" : [ "final", "private" ],
    "annotations" : [ ],
    "documentation" : null,
    "constantValue" : null
  } ],
  "constructors" : [ {
    "name" : "CachingAggregateRepository",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#CachingAggregateRepository",
    "modifiers" : [ "public" ],
    "annotations" : [ ],
    "typeParameters" : [ ],
    "parameters" : [ ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  } ],
  "methods" : [ {
    "name" : "asEntity",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#asEntity",
    "returnType" : "io.fluxzero.sdk.modeling.Entity<T>",
    "modifiers" : [ "public" ],
    "annotations" : [ {
      "annotationType" : "java.lang.Override",
      "values" : {}
    } ],
    "typeParameters" : [ "T" ],
    "parameters" : [ {
      "name" : "entityId",
      "type" : "T",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "catchUpIfNeeded",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#catchUpIfNeeded",
    "returnType" : "void",
    "modifiers" : [ "protected" ],
    "annotations" : [ ],
    "typeParameters" : [ ],
    "parameters" : [ ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "deleteAggregate",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#deleteAggregate",
    "returnType" : "java.util.concurrent.CompletableFuture<java.lang.Void>",
    "modifiers" : [ "public" ],
    "annotations" : [ {
      "annotationType" : "java.lang.Override",
      "values" : {}
    } ],
    "typeParameters" : [ ],
    "parameters" : [ {
      "name" : "aggregateId",
      "type" : "java.lang.Object",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "getAggregatesFor",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#getAggregatesFor",
    "returnType" : "java.util.Map<java.lang.String,java.lang.Class<?>>",
    "modifiers" : [ "public" ],
    "annotations" : [ {
      "annotationType" : "java.lang.Override",
      "values" : {}
    } ],
    "typeParameters" : [ ],
    "parameters" : [ {
      "name" : "entityId",
      "type" : "java.lang.Object",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "handleEvent",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#handleEvent",
    "returnType" : "void",
    "modifiers" : [ "private" ],
    "annotations" : [ ],
    "typeParameters" : [ ],
    "parameters" : [ {
      "name" : "m",
      "type" : "io.fluxzero.sdk.common.serialization.DeserializingMessage",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "handleEvents",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#handleEvents",
    "returnType" : "void",
    "modifiers" : [ "protected" ],
    "annotations" : [ ],
    "typeParameters" : [ ],
    "parameters" : [ {
      "name" : "messages",
      "type" : "java.util.List<io.fluxzero.common.api.SerializedMessage>",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "load",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#load",
    "returnType" : "io.fluxzero.sdk.modeling.Entity<T>",
    "modifiers" : [ "public" ],
    "annotations" : [ {
      "annotationType" : "java.lang.Override",
      "values" : {}
    } ],
    "typeParameters" : [ "T" ],
    "parameters" : [ {
      "name" : "aggregateId",
      "type" : "java.lang.@lombok.NonNull Object",
      "varArgs" : false,
      "annotations" : [ {
        "annotationType" : "lombok.NonNull",
        "values" : {}
      } ]
    }, {
      "name" : "type",
      "type" : "java.lang.Class<T>",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "loadFor",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#loadFor",
    "returnType" : "io.fluxzero.sdk.modeling.Entity<T>",
    "modifiers" : [ "public" ],
    "annotations" : [ {
      "annotationType" : "java.lang.Override",
      "values" : {}
    } ],
    "typeParameters" : [ "T" ],
    "parameters" : [ {
      "name" : "entityId",
      "type" : "java.lang.@lombok.NonNull Object",
      "varArgs" : false,
      "annotations" : [ {
        "annotationType" : "lombok.NonNull",
        "values" : {}
      } ]
    }, {
      "name" : "defaultType",
      "type" : "java.lang.Class<?>",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "repairRelationships",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#repairRelationships",
    "returnType" : "java.util.concurrent.CompletableFuture<java.lang.Void>",
    "modifiers" : [ "public" ],
    "annotations" : [ {
      "annotationType" : "java.lang.Override",
      "values" : {}
    } ],
    "typeParameters" : [ ],
    "parameters" : [ {
      "name" : "aggregate",
      "type" : "io.fluxzero.sdk.modeling.Entity<?>",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "startTrackerIfNeeded",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#startTrackerIfNeeded",
    "returnType" : "void",
    "modifiers" : [ "protected" ],
    "annotations" : [ ],
    "typeParameters" : [ ],
    "parameters" : [ ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  }, {
    "name" : "updateRelationships",
    "qualifiedName" : "io.fluxzero.sdk.persisting.repository.CachingAggregateRepository#updateRelationships",
    "returnType" : "void",
    "modifiers" : [ "protected" ],
    "annotations" : [ ],
    "typeParameters" : [ ],
    "parameters" : [ {
      "name" : "before",
      "type" : "io.fluxzero.sdk.modeling.Entity<?>",
      "varArgs" : false,
      "annotations" : [ ]
    }, {
      "name" : "after",
      "type" : "io.fluxzero.sdk.modeling.Entity<?>",
      "varArgs" : false,
      "annotations" : [ ]
    } ],
    "thrownTypes" : [ ],
    "varArgs" : false,
    "documentation" : null
  } ],
  "enumConstants" : [ ],
  "recordComponents" : [ ],
  "nestedTypes" : [ ]
}
